
<html>
<head>
<title></title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js" integrity="sha512-eVL5Lb9al9FzgR63gDs1MxcDS2wFu3loYAgjIH0+Hg38tCS8Ag62dwKyH+wzDb+QauDpEZjXbMn11blw8cbTJQ==" crossorigin="anonymous"></script>
<script src="assets/js/Chart.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

  
#logs{
  padding:10px;
  height: 100%;
}


</style>

</head>
<body>

<p id="log" ></p>


  <canvas id="chart" width="100%" height="70%">

  </canvas>
  
  <input id="amount" value="0">
  <input id="leverage" value="25">
  <button id="buy" onclick="buyReq(null,null)">Buy</button>
  <button id="sell" onclick="sellReq(null,null)">Sell</button>
  <button id="cancelAll" onclick="cancellAll()">Cancel All </button>
  
  <p id="balance">Balance</p>
  
  
<script type="text/javascript">

balance=document.querySelector("#balance");
amount=document.querySelector("#amount");
leverage=document.querySelector("#leverage");
buy=document.querySelector("#buy");
sell=document.querySelector("#sell");
cancelAll=document.querySelector("#cancelAll");

url="https://site498.glitch.me";
bal=0
onceDone=false;

function getBal(){
fetch(url+"/getBalance").then((val)=>{
  return val.json();
  }).then((vall)=>{
    bal=vall.assets[1]["walletBalance"]
    balance.innerHTML=bal;
  });
  
}
  
  getBal();

function buyReq(amnt, lever){
  
  if(amnt==null||lever==null){
    
    amnt=amount.value;
    lever=leverage.value;
    
  }
  fetch(url+"/buy?amount="+amnt+"&leverage="+lever).then((val)=>{
  return val.json();
  }).then((vall)=>{
    balance.insertAdjacentHTML("afterend",JSON.stringify(vall));
  });
  
  getBal();
  
}

function sellReq(amnt, lever){
  
  
  if(amnt==null||lever==null){
    
    amnt=amount.value;
    lever=leverage.value;
    
  }
  
  fetch(url+"/sell?amount="+amnt+"&leverage="+lever).then((val)=>{
  return val.json();
  }).then((vall)=>{
    balance.insertAdjacentHTML("afterend",JSON.stringify(vall));
  });
  
  getBal();
  
}


function cancellAll(){
  
  fetch(url+"/cancelAll").then((val)=>{
  return val.json();
  }).then((vall)=>{
    balance.insertAdjacentHTML("afterend",JSON.stringify(vall));
  });
  
  getBal();
  
}
var ctx = document.getElementById('chart').getContext('2d');
    
    dur=200;
    fee=0.2;
    prevPrc=0;
    count = 0;
    volt=5;
    prc=57000;
    
var chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [count],
        datasets: [{
          label: 'Chart',
          data: [],
          backgroundColor: [],
          borderColor: ["yellow"
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: false
            }
          }],
          
        },
        animation: {
        duration: dur*1,
        easing: 'easeOutExpo'
        }
      }
    });
	minInChart=0;
    function addData(chart, label, data, color) {
      chart.data.labels.push(label);
      chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
        dataset.backgroundColor.push(color);
        minInChart=(Math.min.apply(Math,dataset.data));
      });
      chart.update();
    }
    
    function removeData(chart) {
    chart.data.labels.splice(0,1);
    chart.data.datasets.forEach((dataset) => {
    dataset.data.splice(0,1);
    dataset.backgroundColor.splice(0,1);
    });
    chart.update();
    }
    


p=document.querySelector("#log");
var socket = new WebSocket('wss://btc.data.hxro.io/live');

lastPrc=0;
win=0;
loss=0;
rate=0;

socket.onmessage = function (event) {
    var msg = (event.data);
    dat=JSON.parse(JSON.stringify(msg).replaceAll("\\","").slice(1,-1));
    prc=parseFloat(dat["price"]);
    ts=new Date(dat["ts"]);
    
    up = prc>lastPrc;
    diff=prc-lastPrc;
    
    if(up){
    col="yellow";
    win++;
    }else{
    col="lightblue";
      loss++;
    }
    rate=Number(win/(win+loss)*100).toFixed(2);
    lastPrc=prc;
  	p.innerHTML=prc+"<br>"+rate+"%";
  	if(diff>10)p.style.backgroundColor="yellow";
    if(diff<-10)p.style.backgroundColor="lightblue";
    addData(chart,ts.getMinutes()+":"+ts.getSeconds(),prc,col);
    count++;
    if(count > 200){
    removeData(chart);
    }
    
    
    if(!onceDone&&bal!=0){
      amount.value=((leverage.value*bal)/prc).toFixed(5);
      onceDone=true;
    }
    
};




setInterval(function(){
  
  
  if(rate<50){
    rate=(parseFloat(rate)+0.1).toFixed(2);
  }else{
    rate=(parseFloat(rate)-0.1).toFixed(2);
  }
  p.innerHTML=prc+"<br>"+rate+"%";
  	
},30);




</script>
</body>
</html>