
<html>
<head>
<title></title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js" integrity="sha512-eVL5Lb9al9FzgR63gDs1MxcDS2wFu3loYAgjIH0+Hg38tCS8Ag62dwKyH+wzDb+QauDpEZjXbMn11blw8cbTJQ==" crossorigin="anonymous"></script>
<script src="assets/js/Chart.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  
#logs{
  padding:10px;
  height: 100%;
}


</style>

</head>
<body>

<p id="log" ></p>


  <canvas id="chart" width="100%" height="70%">

  </canvas>
  
  
  
<script type="text/javascript">


var ctx = document.getElementById('chart').getContext('2d');
    
    dur=200;
    fee=0.2;
    prevPrc=0;
    count = 0;
    volt=5;
    prc=57000;
    
var chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [count],
        datasets: [{
          label: 'Chart',
          data: [],
          backgroundColor: [],
          borderColor: ["yellow"
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: false
            }
          }],
          
        },
        animation: {
        duration: dur*1,
        easing: 'easeOutExpo'
        }
      }
    });
	minInChart=0;
    function addData(chart, label, data, color) {
      chart.data.labels.push(label);
      chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
        dataset.backgroundColor.push(color);
        minInChart=(Math.min.apply(Math,dataset.data));
      });
      chart.update();
    }
    
    function removeData(chart) {
    chart.data.labels.splice(0,1);
    chart.data.datasets.forEach((dataset) => {
    dataset.data.splice(0,1);
    dataset.backgroundColor.splice(0,1);
    });
    chart.update();
    }
    


p=document.querySelector("#log");
var socket = new WebSocket('wss://btc.data.hxro.io/live');

lastPrc=0;

socket.onmessage = function (event) {
    var msg = (event.data);
    dat=JSON.parse(JSON.stringify(msg).replaceAll("\\","").slice(1,-1));
    prc=parseFloat(dat["price"]);
    ts=new Date(dat["ts"]);
    
    up = prc>lastPrc;
    if(up){
    col="yellow";
    }else{
    col="lightblue"}
    
    lastPrc=prc;
  	p.textContent=prc;
  	p.style.backgroundColor=col;
    addData(chart,ts.getMinutes()+":"+ts.getSeconds(),prc,col);
    count++;
    if(count > 200){
    removeData(chart);
    }
    
    
};
</script>
</body>
</html>